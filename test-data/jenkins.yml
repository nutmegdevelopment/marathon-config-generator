id: jenkins
cpus: 0.2
mem: 4000
instances: 1
env:
  JAVA_OPTS: "-Xmx2560m -Xms2560m -Djenkins.install.runSetupWizard=false -Dhudson.model.ParametersAction.safeParameters=PIPELINE_VERSION"
  JENKINS_SLAVE_AGENT_PORT: 32000
  MARATHON_DEV: "http://marathon.mesos:8080"
  MARATHON_PROD: "http://internal-mesos-marathon-elb-internal-prod-2068344653.eu-west-1.elb.amazonaws.com:8080"
  CONSUL_DEV: "master.mesos:8500"
  CONSUL_PROD: "internal-mesos-master-elb-internal-prod-1986984040.eu-west-1.elb.amazonaws.com:8500"
  MARATHON_DEV_WITH_CREDENTIALS: "http://marathon:NutmegMarathon@marathon.mesos:8080"
  MARATHON_PROD_WITH_CREDENTIALS: "http://marathon:NutmegMarathon@internal-mesos-marathon-elb-internal-prod-2068344653.eu-west-1.elb.amazonaws.com:8080"
constraints:
  -
    - "tier"
    - "CLUSTER"
    - "public"
  -
    - "az"
    - "CLUSTER"
    - "c"
container:
  docker:
    image: registry.nutmeg.co.uk:8443/jenkins:2.0.74
    portMappings:
      -
        containerPort: 8080
        hostPort: 31998
      -
        containerPort: 32000
        hostPort: 32000
    parameters:
      -
        key: "label"
        value: "APP_NAME=jenkins-master"
      -
        key: "label"
        value: "APP_BUILD=2.0.74"
      -
        key: security-opt
        value: label:disable
      -
        key: volume-driver
        value: rexray
      -
        key: volume
        value: jenkins-data:/var/jenkins_home/jobs
healthchecks:
  -
    protocol: HTTPS
    portIndex: 0
    path: /metrics/o1dFU6TCxlJcKF-spBMAN2ACHz3TKIE5iqQWGLYUxXdQlpVmPoynAmZlHoVJFu3U/ping
    gracePeriodSeconds: 180
    intervalSeconds: 10
    timeoutSeconds: 20
    maxConsecutiveFailures: 3
labels:
  environment: dev
  HAPROXY_GROUP: external,internal
  HAPROXY_0_VHOST: jenkins.dev.nutmeg.co.uk,jenkins.local
  HAPROXY_0_REDIRECT_TO_HTTPS: true
  HAPROXY_0_USE_HSTS: true
  HAPROXY_1_VHOST: slave-jenkins.dev.nutmeg.co.uk
upgradeStrategy:
  minimumHealthCapacity: 0
  maximumOverCapacity: 0